<div class="row">
  <div class="col-sm-10">
    <span class="h2"><%= @course.courseName %>
      <small><%= @course.courseDesc %></small></span>
  </div>
  <% if admin? %>
      <div class="col-sm-2" align="right">
        <%= link_to "Editar Clase", edit_course_path(@course) %><br>
        <%= link_to "Eliminar Clase", @course, method: :delete, data: {confirm: "¿Seguro que quieres eliminar esta clase?"} %>
      </div>
  <% end %>
</div>
<br>
<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">Clases</div>

  <table id="offerings" class="table">
    <thead>
    <tr>
      <th>Fecha</th>
      <th>Notas</th>
      <th>Precio</th>
      <th>
        <% if admin? %>
            Admin
        <% else %>
            Registracion
        <% end %>
      </th>
    </tr>
    </thead>
    <tbody>
    <% @offerings.each do |offering| %>
        <tr>
          <td><%= offering.courseDate %></td>
          <td><%= offering.courseNotes %></td>
          <td><%= number_to_currency(offering.coursePrice) %></td>
          <td>
            <% if admin? %>
                <%= link_to "Editar clase", edit_offering_path(offering) %>
                |
                <%= link_to "Eliminar clase", offering, method: :delete, data: {confirm: "¿Seguro que quieres eliminar esta ofrenda?"} %>
            <% elsif session[:user_id] %>
                <% if @registered_offering_ids.include? offering.id %>
                    Te has registrado para esta ofrenda de curso.
                <% else %>
                    <%= form_tag charges_path do %>
                        ¡Pulse aquí para registrarse y pagar!
                        <input type="hidden" name="amount" value="<%= offering.coursePrice*100 %>">
                        <input type="hidden" name="offering_id" value="<%= offering.id %>">
                        <input type="hidden" name="description" value="<%= @course.courseName %>">
                        <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                                data-description="<%= @course.courseName %>"
                                data-amount="<%= offering.coursePrice*100 %>"
                                data-locale="auto"></script>
                    <% end %>
                      <!--<%= link_to "¡Pulse aquí para registrarse!", rosters_path(roster: {user_id: session[:user_id], offering_id: offering.id}), method: :post %>-->
                <% end %>
            <% else %>
                ¡Inicia sesión para registrarte!
            <% end %>
          </td>
        </tr>
    <% end %>
    </tbody>
    <% if admin? %>
        <tfoot>
        <tr>
          <td colspan="4" align="center">
            <%= link_to "Agregar Nueva Ofrenda", new_offering_path(course_id: @course), class: 'btn btn-default btn-primary', role: 'button' %>
          </td>
        </tr>
        </tfoot>
    <% end %>
  </table>
</div>
